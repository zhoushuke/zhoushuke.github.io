<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhoushuke.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="在Devops中经常面对的一个问题就是，如何将敏感信息保存在git中, 虽然kubernetes提供了secret，但它也只是Base64转换了一下, 任何人拿到这个串都可以反转出来，不安全. 在GitOps的流程上, 如何解决save everything on git but secrets的问题一直是个非常有趣的话题，而今天要说的Sealed Secrets就是一个很好的工具, 可以与Kub">
<meta property="og:type" content="article">
<meta property="og:title" content="Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中)">
<meta property="og:url" content="https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/index.html">
<meta property="og:site_name" content="Z.S.K.&#39;s Records">
<meta property="og:description" content="在Devops中经常面对的一个问题就是，如何将敏感信息保存在git中, 虽然kubernetes提供了secret，但它也只是Base64转换了一下, 任何人拿到这个串都可以反转出来，不安全. 在GitOps的流程上, 如何解决save everything on git but secrets的问题一直是个非常有趣的话题，而今天要说的Sealed Secrets就是一个很好的工具, 可以与Kub">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624125407.png">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624123543.png">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624140240.png">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624140831.png">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624142108.png">
<meta property="og:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624190637.png">
<meta property="article:published_time" content="2020-06-24T08:10:53.000Z">
<meta property="article:modified_time" content="2024-12-31T03:07:38.319Z">
<meta property="article:author" content="周淑科">
<meta property="article:tag" content="Kubernetes">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624125407.png">


<link rel="canonical" href="https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/","path":"2020/06/24/Kubernetes-sealed-secrets/","title":"Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中) | Z.S.K.'s Records</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Z.S.K.'s Records</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/ZSK-Profile.pdf" rel="section"><i class="fa fa-user fa-fw"></i>简历</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85controller"><span class="nav-number">2.</span> <span class="nav-text">安装controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="nav-number">3.</span> <span class="nav-text">密钥对</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85kubeseal"><span class="nav-number">4.</span> <span class="nav-text">安装kubeseal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example"><span class="nav-number">5.</span> <span class="nav-text">Example</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#secret"><span class="nav-number">5.1.</span> <span class="nav-text">secret</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#configmap"><span class="nav-number">5.2.</span> <span class="nav-text">configmap</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deployment"><span class="nav-number">6.</span> <span class="nav-text">deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0secret"><span class="nav-number">7.</span> <span class="nav-text">更新secret</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="nav-number">8.</span> <span class="nav-text">使用范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">9.</span> <span class="nav-text">安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="nav-number">10.</span> <span class="nav-text">参考文章:</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="周淑科"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">周淑科</p>
  <div class="site-description" itemprop="description">Better Later Than Never</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="周淑科">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z.S.K.'s Records">
      <meta itemprop="description" content="Better Later Than Never">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中) | Z.S.K.'s Records">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-24 16:10:53" itemprop="dateCreated datePublished" datetime="2020-06-24T16:10:53+08:00">2020-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>在Devops中经常面对的一个问题就是，如何将敏感信息保存在git中, 虽然kubernetes提供了secret，但它也只是Base64转换了一下, 任何人拿到这个串都可以反转出来，不安全.</p>
<p>在GitOps的流程上, 如何解决save everything on git but secrets的问题一直是个非常有趣的话题，而今天要说的Sealed Secrets就是一个很好的工具, 可以与Kubernetes无缝接入.</p>
<span id="more"></span>



<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624125407.png"></p>
<p>Sealed Secrets 包括以下组成部分：</p>
<ol>
<li>一个部署到集群的控制器</li>
<li>一个名为 <em>kubeseal</em> 的 CLI 工具</li>
<li>一个名为 SealedSecret 的定制化资源定义 (CRD)</li>
</ol>
<p>启动后，控制器会查找集群范围的私钥&#x2F;公钥对，如果未找到，则会生成一个新的 4096 位 RSA 密钥对。私钥保存在一个 Secret 对象中，该对象位于控制器所在的命名空间中。任何想要在此集群中使用 Sealed Secrets 的人都可以公开获得此密钥的公钥部分。</p>
<p>加密时，原始 Secret 中的每个值都使用带有随机生成的会话密钥的 AES-256 方式进行对称加密。然后，将 SHA256 和原始 Secret 的命名空间&#x2F;名称作为输入参数，使用控制器的公钥对会话密钥进行非对称加密。加密过程的输出结果是一个字符串，其构造为：<strong>加密会话密钥的长度（2 个字节）</strong>+ <strong>加密会话密钥</strong> + <strong>已加密的 Secret</strong>。</p>
<p>将 SealedSecret 自定义资源部署到 Kubernetes 集群时，控制器会watch该类资源，然后使用私钥将其解封并创建一个 Secret 资源。解密时，会再次使用 SealedSecret 的命名空间&#x2F;名称作为输入参数。这样可以确保 SealedSecret 和 Secret 严格绑定到相同的命名空间和名称。</p>
<p>配套的 CLI 工具 <strong>kubeseal</strong> 用于使用公钥从 Secret 资源定义中创建 SealedSecret 定制化资源定义 (CRD)。<strong>kubeseal</strong> 可以通过 Kubernetes API 服务器与控制器进行通信，并在运行时检索加密 Secret 所需的公钥。您也可以从控制器下载公钥并保存在本地以便离线使用</p>
<h3 id="安装controller"><a href="#安装controller" class="headerlink" title="安装controller"></a>安装controller</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f controller.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624123543.png"></p>
<h3 id="密钥对"><a href="#密钥对" class="headerlink" title="密钥对"></a>密钥对</h3><p>通过上面生成的CRD之后, 查看<code>sealed-secrets-controller</code>的日志文件可以发现:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2020/06/24 16:34:47 Starting sealed-secrets controller version: v0.12.4+dirty</span><br><span class="line">controller version: v0.12.4+dirty</span><br><span class="line">2020/06/24 16:34:47 Searching <span class="keyword">for</span> existing private keys</span><br><span class="line">2020/06/24 16:34:47 New key written to senserealty/sealed-secrets-keyzslr5 <span class="comment"># 这个secret包含证书及私钥</span></span><br><span class="line">2020/06/24 16:34:47 Certificate is</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line"><span class="comment"># ... 这里是公钥内容</span></span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"></span><br><span class="line">2020/06/24 16:34:47 HTTP server serving on :8080</span><br></pre></td></tr></table></figure>

<p>启动时，控制器会在其命名空间中搜索带有 <strong>sealedsecrets.bitnami.com&#x2F;sealed-secrets-key</strong> 标签的 Secret。如果找不到，控制器会在其命名空间中创建新的 Secret, 查看<code>sealed-secrets-keyzslr5</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret -n senserealty -l sealedsecrets.bitnami.com/sealed-secrets-key -o yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">tls.crt:</span> <span class="comment"># ... 证书</span></span><br><span class="line">  <span class="attr">tls.key:</span> <span class="comment"># ... 私钥</span></span><br><span class="line"><span class="comment"># ...  </span></span><br></pre></td></tr></table></figure>

<p>该secret包含证书及私钥，私钥用于解密集群中的SealedSecret资源.</p>
<h3 id="安装kubeseal"><a href="#安装kubeseal" class="headerlink" title="安装kubeseal"></a>安装kubeseal</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.12.4/kubeseal-linux-amd64 -O kubeseal</span><br><span class="line">sudo install -m 755 kubeseal /usr/local/bin/kubeseal</span><br></pre></td></tr></table></figure>

<p><strong>kubeseal</strong> 使用公钥加密 Secret，该公钥是它在运行时从在 Kubernetes 集群中运行的控制器获取的，也就是说，kubeaeal会读取~&#x2F;.kube&#x2F;config文件来获取集群权限，然后查找集群中的<code>sealed-secrets-controller</code>控制器来获取公钥.</p>
<p>如果无法获取集群权限, 可以通过以下命令直接把公钥下载到本地</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeseal --fetch-cert &gt;mycert.pem --controller-namespace senserealty</span><br></pre></td></tr></table></figure>

<p>在加密时，使用–cert来指定本地的pem公钥文件, 这样的话，就可能够保证集群权限最小化.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeseal --format=yaml --cert=public-key-cert.pem &lt; secret.yaml &gt; sealed-secret.yaml</span><br></pre></td></tr></table></figure>



<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>这里直接使用的是github上的example, 参考<a target="_blank" rel="noopener" href="https://github.com/bitnami-labs/sealed-secrets/blob/master/docs/examples/config-template/deployment.yaml">这里</a></p>
<h4 id="secret"><a href="#secret" class="headerlink" title="secret"></a>secret</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">senserealty</span></span><br><span class="line"><span class="attr">stringData:</span></span><br><span class="line">  <span class="attr">server1:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">server2:</span> <span class="string">bar</span></span><br><span class="line">  <span class="attr">database1:</span> <span class="string">baz</span></span><br></pre></td></tr></table></figure>

<p>通过kubeseal生成sealed-secret</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeseal --format=yaml &lt; secret.yaml &gt; sealed-secret.yaml  --controller-namespace senserealty</span><br><span class="line"><span class="comment"># 默认情况下 controller是安装在kube-system下的, 如果指定在其它ns,则需要使用--controller-namespace</span></span><br></pre></td></tr></table></figure>

<p>会在当前目录下生成sealed-secret.yaml，该文件内容已被加密，将该文件发布到集群中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f sealed-secret.yaml</span><br></pre></td></tr></table></figure>

<p>查看集群中的secret, 会发现secret被解密成正常的secret(通过base64加密过后的)</p>
<p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624140240.png"></p>
<p>同样, 可以在controller中查看到日志，显示该secret被成功解密.</p>
<p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624140831.png"></p>
<h4 id="configmap"><a href="#configmap" class="headerlink" title="configmap"></a>configmap</h4><p>官方的example里还包含了一个configmap, 该configmap里引用了上面的secret, 最终我们验证的时候可以看configmap中引用的内容是否正确. </p>
<p><strong>这也是生产上常用的方式, app中的配置使用configmap，但是敏感的信息也不能放在configmap中, 因此configmap中使用了模板的形式引用被kubeseal加密后的secret</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">senserealty</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myconfig.json.tmpl:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">           &quot;Server&quot;: [&#123;</span></span><br><span class="line"><span class="string">                           &quot;host&quot;: &quot;foobar&quot;,</span></span><br><span class="line"><span class="string">                           &quot;ip&quot;: &quot;10.10.10.12&quot;,</span></span><br><span class="line"><span class="string">                           &quot;port&quot;: &quot;22&quot;,</span></span><br><span class="line"><span class="string">                           &quot;env&quot;: &quot;SOME_ENV&quot;,</span></span><br><span class="line"><span class="string">                           &quot;user&quot;: &quot;myuser&quot;,</span></span><br><span class="line"><span class="string">                           &quot;password&quot;: &quot;&#123;&#123; (ds &quot;secrets&quot; &quot;server1&quot;) &#125;&#125;&quot;, # 引用变量</span></span><br><span class="line"><span class="string">                           &quot;role&quot;: &quot;foo&quot;</span></span><br><span class="line"><span class="string">                   &#125;,&#123;</span></span><br><span class="line"><span class="string">                           &quot;host&quot;: &quot;barfoo&quot;,</span></span><br><span class="line"><span class="string">                           &quot;ip&quot;: &quot;10.10.10.11&quot;,</span></span><br><span class="line"><span class="string">                           &quot;port&quot;: &quot;22&quot;,</span></span><br><span class="line"><span class="string">                           &quot;env&quot;: &quot;SOME_OTHER_STUFF&quot;,</span></span><br><span class="line"><span class="string">                           &quot;user&quot;: &quot;otheruser&quot;,</span></span><br><span class="line"><span class="string">                           &quot;password&quot;: &quot;&#123;&#123; (ds &quot;secrets&quot; &quot;server2&quot;) &#125;&#125;&quot;, # 引用变量</span></span><br><span class="line"><span class="string">                           &quot;role&quot;: &quot;foo&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">           ],</span></span><br><span class="line"><span class="string">           &quot;Database&quot;: [&#123;</span></span><br><span class="line"><span class="string">                           &quot;host&quot;: &quot;somedb&quot;,</span></span><br><span class="line"><span class="string">                           &quot;ip&quot;: &quot;10.10.10.10&quot;,</span></span><br><span class="line"><span class="string">                           &quot;port&quot;: &quot;1521&quot;,</span></span><br><span class="line"><span class="string">                           &quot;sid&quot;: &quot;FOO&quot;,</span></span><br><span class="line"><span class="string">                           &quot;env&quot;: &quot;BAZ&quot;,</span></span><br><span class="line"><span class="string">                           &quot;user&quot;: &quot;abcdefg123&quot;,</span></span><br><span class="line"><span class="string">                           &quot;password&quot;: &quot;&#123;&#123; (ds &quot;secrets&quot; &quot;database1&quot;) &#125;&#125;&quot;, # 引用变量</span></span><br><span class="line"><span class="string">                           &quot;role&quot;: &quot;foo&quot;</span></span><br><span class="line"><span class="string">                   &#125;</span></span><br><span class="line"><span class="string">           ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br></pre></td></tr></table></figure>

<p>发布到集群中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f configmap.yaml</span><br></pre></td></tr></table></figure>



<h3 id="deployment"><a href="#deployment" class="headerlink" title="deployment"></a>deployment</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">example</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">inject-secrets</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">hairyhenderson/gomplate:alpine</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="comment"># The /secrets directory will contain one file per secret item.</span></span><br><span class="line">        <span class="comment"># The secret item&#x27;s key will become the file name, while its value goes in the file contents.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-secrets-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/secrets</span></span><br><span class="line">        <span class="comment"># The config map containing the config file template will be available here.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-template-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/input</span></span><br><span class="line">        <span class="comment"># While the expanded template will be put in a volume shared with the application which will run</span></span><br><span class="line">        <span class="comment"># in the main container when this init container is done.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/output</span></span><br><span class="line">        <span class="comment"># Now we can actually run the template expander and inject secrets into the template.</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">gomplate</span> <span class="string">-d</span> <span class="string">secrets=/secrets/</span> <span class="string">&lt;/input/myconfig.json.tmpl</span> <span class="string">&gt;/output/myconfig.json</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="comment"># This is an example application that assumes a complex configuration file in /config/myconfig.json.</span></span><br><span class="line">      <span class="comment"># The JSON format here is just an example; any textual file format would work.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">bitnami/minideb:buster</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/config</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">         echo Your app will get this config file:</span></span><br><span class="line"><span class="string">         cat /config/myconfig.json</span></span><br><span class="line"><span class="string">         # dummy application</span></span><br><span class="line"><span class="string">         sleep 100000h</span></span><br><span class="line"><span class="string"></span>      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">emptyDir:</span> &#123;&#125;</span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-template-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-secrets-volume</span></span><br><span class="line">        <span class="attr">secret:</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">example</span></span><br></pre></td></tr></table></figure>

<p> 该deployment有一个initcontainer, 用<a target="_blank" rel="noopener" href="https://github.com/hairyhenderson/gomplate">goemplate</a>将secret填充configmap中的变量, 然后containers中的容器直接打印最终的config配置</p>
<p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624142108.png"></p>
<p>从上面可以看出, configmap中的变量跟原始的secret中的值完全一样. 达到了对secret加解密的作用.</p>
<h3 id="更新secret"><a href="#更新secret" class="headerlink" title="更新secret"></a>更新secret</h3><p>SealedSecret支持对存在的secret进行更新.</p>
<p>可使用 <code>--merge-into</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个secret, 文件名为foo,内容为bar</span></span><br><span class="line"><span class="built_in">echo</span> -n bar | kubectl create secret generic mysecret --dry-run --from-file=foo=/dev/stdin -o json \</span><br><span class="line">  | kubeseal &gt; mysealedsecret.json</span><br><span class="line"><span class="comment"># 更新secret, 新增一个文件为bar, 内容为baz</span></span><br><span class="line"><span class="built_in">echo</span> -n baz | kubectl create secret generic mysecret --dry-run --from-file=bar=/dev/stdin -o json \</span><br><span class="line">  | kubeseal --merge-into mysealedsecret.json</span><br></pre></td></tr></table></figure>

<p>当然也可以按照正常的更新secret的方式，先更新secret ，然后使用SealedSecret加密，然后发布到集群中，然后更新app.</p>
<p>最后可以看到，app中的config也更新了.</p>
<p><img src="https://raw.gitmirror.com/zhoushuke/BlogPhoto/master/githuboss/20200624190637.png"></p>
<h3 id="使用范围"><a href="#使用范围" class="headerlink" title="使用范围"></a>使用范围</h3><p>SealedSecret提供了3种对ns的安全限制， 我大概看了下说明, 觉得虽然会更安全, 但是会带来使用上的复杂性, 大部分情况下，secret还是会跟app在同一ns中,因此这块内容本人没有实验， 可参考<a target="_blank" rel="noopener" href="https://github.com/bitnami-labs/sealed-secrets/blob/master/README.md#scopes">scope</a></p>
<ul>
<li><code>strict</code> (default): the secret must be sealed with exactly the same <em>name</em> and <em>namespace</em>. These attributes become <em>part of the encrypted data</em> and thus changing name and&#x2F;or namespace would lead to “decryption error”.</li>
<li><code>namespace-wide</code>: you can freely <em>rename</em> the sealed secret within a given namespace.</li>
<li><code>cluster-wide</code>: the secret can be unsealed in <em>any</em> namespace and can be given <em>any</em> name.</li>
</ul>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><p>如果没有由控制器管理的私钥，就无法在 SealedSecret 中对已加密的数据进行解密。如果SealedSecret被集群广泛使用, 那么就需要小心集群发生灾难性异常，在恢复之后或者迁移到一个新集群之后，新集群中部署的控制器必须使用相同的私钥才能解封 SealedSecrets。如果没有此私钥，则必须使用新的私钥&#x2F;公钥对重新生成所有 SealedSecrets，这对于包含大量 Secret 资源的部署可能会是一项繁重的任务。因此备份私钥非常有必要， 可以使用以下命令从控制器中获取证书及私钥写到文件中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret -n senserealty -l sealedsecrets.bitnami.com/sealed-secrets-key -o yaml &gt; master.yaml</span><br></pre></td></tr></table></figure>

<p>这样，即使整个集群崩溃或者迁移到新集群之后，使用相同的私钥创建的SealedSecret CRD同样可以解密由这个私钥加密的secret.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">master.yaml</span></span><br><span class="line"><span class="comment"># 当集群中已经存在sealedsecrets.bitnami.com/sealed-secrets-key时，则不会新建</span></span><br><span class="line"><span class="attr">2020/06/24 23:26:07 Starting sealed-secrets controller version:</span> <span class="string">v0.12.1+dirty</span></span><br><span class="line"><span class="attr">controller version:</span> <span class="string">v0.12.1</span></span><br><span class="line"><span class="number">2020</span><span class="string">/06/24</span> <span class="number">23</span><span class="string">:26:07</span> <span class="string">Searching</span> <span class="string">for</span> <span class="string">existing</span> <span class="string">private</span> <span class="string">keys</span></span><br><span class="line"><span class="number">2020</span><span class="string">/06/24</span> <span class="number">23</span><span class="string">:26:07</span> <span class="string">-----</span> <span class="string">sealed-secrets-keyhvdtf</span></span><br><span class="line"><span class="number">2020</span><span class="string">/06/24</span> <span class="number">23</span><span class="string">:26:07</span> <span class="string">HTTP</span> <span class="string">server</span> <span class="string">serving</span> <span class="string">on</span> <span class="string">:8080</span></span><br></pre></td></tr></table></figure>



<p>通过这种方式, 敏感信息可以只被少数人掌握, 开发同学则直接引用加密后的信息即可</p>
<p>当然，上面的例子只是一个demo, SealedSecret提供了一种思路，生产中SealedSecret如何更好地对接kubernetes app, 还需要进一步地研究.</p>
<p>就跟SealedSecret官方说的那样:</p>
<p><strong>Problem:</strong> “I can manage all my K8s config in git, except Secrets.”</p>
<p><strong>Solution:</strong> Encrypt your Secret into a SealedSecret, which <em>is</em> safe to store - even to a public repository. The SealedSecret can be decrypted only by the controller running in the target cluster and nobody else (not even the original author) is able to obtain the original Secret from the SealedSecret</p>
<p><strong>SealedSecret在GitOps的流程上又推进了一步.</strong></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章:"></a><strong>参考文章:</strong></h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/cn/blogs/china/managing-secrets-deployment-in-kubernetes-using-sealed-secrets/">https://aws.amazon.com/cn/blogs/china/managing-secrets-deployment-in-kubernetes-using-sealed-secrets/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bitnami-labs/sealed-secrets">https://github.com/bitnami-labs/sealed-secrets</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bitnami-labs/sealed-secrets/blob/master/README.md#scopes">https://github.com/bitnami-labs/sealed-secrets/blob/master/README.md#scopes</a></li>
</ul>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy Me a Coffee</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpayme.png" alt="周淑科 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipayme.jpg" alt="周淑科 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>周淑科
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/" title="Kubernetes学习(Sealed Secrets如何安全地将密码存储在git中)">https://zhoushuke.github.io/2020/06/24/Kubernetes-sealed-secrets/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请保留原文作者及链接！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Kubernetes/" rel="tag"># Kubernetes</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/06/18/why-x509-error-when-curl-https/" rel="prev" title="访问https时为何会出现x509 certificate signed by unknown authority">
                  <i class="fa fa-angle-left"></i> 访问https时为何会出现x509 certificate signed by unknown authority
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/06/28/Kubernetes-configmap-reference-var-from-secret/" rel="next" title="Kubernetes学习(在configmap中引用secret)">
                  Kubernetes学习(在configmap中引用secret) <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">周淑科</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">985k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">14:55</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://cn.vercount.one/js"></script>





</body>
</html>
